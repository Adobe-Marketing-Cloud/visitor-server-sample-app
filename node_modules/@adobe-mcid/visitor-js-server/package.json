{
  "_args": [
    [
      {
        "name": "@adobe-mcid/visitor-js-server",
        "raw": "@adobe-mcid/visitor-js-server@git+ssh://git@git.corp.adobe.com:mc-visitor/visitor-js-server.git#feature/batch-payload",
        "rawSpec": "git+ssh://git@git.corp.adobe.com:mc-visitor/visitor-js-server.git#feature/batch-payload",
        "scope": "@adobe-mcid",
        "spec": "ssh://git@git.corp.adobe.com:mc-visitor/visitor-js-server.git#feature/batch-payload",
        "type": "git"
      },
      "/Users/khoury/Adobe/visitor-server-sample-app"
    ]
  ],
  "_from": "git+ssh://git@git.corp.adobe.com:mc-visitor/visitor-js-server.git#feature/batch-payload",
  "_id": "@adobe-mcid/visitor-js-server@0.0.9-alpha.1",
  "_inCache": true,
  "_installable": true,
  "_location": "/@adobe-mcid/visitor-js-server",
  "_phantomChildren": {},
  "_requested": {
    "name": "@adobe-mcid/visitor-js-server",
    "raw": "@adobe-mcid/visitor-js-server@git+ssh://git@git.corp.adobe.com:mc-visitor/visitor-js-server.git#feature/batch-payload",
    "rawSpec": "git+ssh://git@git.corp.adobe.com:mc-visitor/visitor-js-server.git#feature/batch-payload",
    "scope": "@adobe-mcid",
    "spec": "ssh://git@git.corp.adobe.com:mc-visitor/visitor-js-server.git#feature/batch-payload",
    "type": "git"
  },
  "_requiredBy": [
    "/"
  ],
  "_resolved": "git+ssh://git@git.corp.adobe.com:mc-visitor/visitor-js-server.git#6d53bc1282c69a508714cfc9ba47d64ac261c28f",
  "_shasum": "b65eeece06bba79efe2a18ce574ea706aeb906cd",
  "_shrinkwrap": null,
  "_spec": "@adobe-mcid/visitor-js-server@git+ssh://git@git.corp.adobe.com:mc-visitor/visitor-js-server.git#feature/batch-payload",
  "_where": "/Users/khoury/Adobe/visitor-server-sample-app",
  "author": {
    "name": "Marketing Cloud ID Team"
  },
  "dependencies": {
    "@adobe-mcid/visitor-js-shared": "~0.0.1"
  },
  "description": "Server compatible Visitor ID service",
  "devDependencies": {
    "autochecker": "git+https://github.com/jfkhoury/autochecker.git",
    "babel-cli": "^6.14.0",
    "babel-plugin-add-module-exports": "^0.2.1",
    "babel-plugin-minify-mangle-names": "0.0.3",
    "babel-plugin-transform-object-rest-spread": "^6.8.0",
    "babel-preset-babili": "0.0.3",
    "babel-preset-es2015": "^6.14.0",
    "babel-tape-runner": "^2.0.1",
    "eslint": "^3.4.0",
    "nodemon": "^1.10.2",
    "pre-commit": "^1.1.3",
    "tap-spec": "^4.1.1",
    "tape": "^4.6.0"
  },
  "gitHead": "6d53bc1282c69a508714cfc9ba47d64ac261c28f",
  "license": "ADOBE VISITOR.JS SERVER LIBRARY LICENSE AGREEMENT",
  "main": "lib/Visitor.js",
  "name": "@adobe-mcid/visitor-js-server",
  "optionalDependencies": {},
  "pre-commit": [
    "precommit-msg",
    "lint",
    "test"
  ],
  "readme": "# Visitor JS - Server Side\n\nThis is a trimmed down version of the `VisitorAPI` JS library. It is designed to run on your server, either in a NodeJS or Rhino environment.\n\n\n## Provided Interfaces\n\n- generatePayload(sdidConsumerID: string, amcvCookie: string) : VisitorPayload\n- getState() : State { OrgID: { sdid, customerIDs }\n- Visitor#AuthState : Static Enum\n- getCookieName : AMCV cookie name\n- setCustomerIDs (object: customerIDs)\n\n\n## What is an `sdid`\n\n`SDID` is a randomly generated string that is sent in on each call that needs to be combined into a single Analytics entry.\n\nWhen implementing Target server side, and Analytics client side, you need some sort of mechanism to synchronize the states between the client and the server. `SDID` is part of this state, which is an ID that allows us to combine calls to Target and calls to Analytics into a cohesive set of data.\n\nCustomer who are implementing Target client-side, don't need to worry about sdid.\n\n\n## What is an `sdidConsumerID`\n\n`sdidConsumerID` is a unique string used to intentify the consumer.\n\nAll calls to Target that needs to combined must have the same `SDID`. Each of those calls need to have a unique `sdidConsumerID` in order for them to receive the `SAME SDID`.\n\nIn order to properly combine data, you must call `visitor#generatePayload` for every call to target, passing a unique `sdidConsumerID` for each call. We recommend using mbox names as `sdidConsumerID`.\n\n\n## `generatePayload`\n\nThis method should be called for every Target call to generate an object that gets merged into the Target request.\n\nParameters:\n\n- `sdidConsumerID`: As mentioned above, an `sdidConsumerID` must be provided.\n- `amcvCookie`: If an AMCV cookie exists in the browser request, you will need to provide it as well. Use the `visitor#getCookieName` helper to retrieve the cookie name related to your OrgID.\n\n```javascript\n    // 1. Retrieve the AMCV cookie from the request.\n    var cookies = cookie.parse(req.headers.cookie || \"\");\n    var cookieName = visitor.getCookieName();\n    var amcvCookie = cookies[cookieName];\n\n    // 2. Generate Visitor Payload by passing sdidConsumerID (mbox name/id) and AMCV Cookie if found in Req.\n    var visitorPayload = visitor.generatePayload({ \n        sdidConsumerID: mboxName,\n        amcvCookie: amcvCookie \n    });\n\n    // 3. Merge the `visitorPayload` with you target specific into and make the Target call.\n    var targetPayload = {\n            requestLocation: {\n            \"pageURL\" : config.pageURL,\n            \"impressionId\" : \"1\",\n            \"host\" : config.host\n        },\n        thirdPartyId: xxx,\n        tntId: xxx\n    };\n    var fullPayload = Object.assign({}, visitorPayload, targetPayload);\n    ...\n```\n\n\n## `getState`\n\nThis method returns the internal state of the Visitor instance, which should be shared with the VisitorAPI client side library later on.\n\n\n## `getCookieName`\n\nSimple helper that provides the AMCV cookie name to be retrieved from the Request.\n\n\n## `setCustomerIDs`\n\nThe `setCustomerIDs` method accepts multiple customer IDs for the same visitor. This helps you identify or target an individual user across different devices. For example, you can upload these IDs as customer attributes to the Marketing Cloud and access this data across the different solutions.\n\nOn the server, we are using this method to share those ids with Target, as well as adding them to the state that is shared with the client side VisitorAPI library.\n\n<strong>IMPORTANT:</strong>\n\n- In order for those IDs to make it into the Target call, make sure you call `setCustomerIDs` before calling `generatePayload`.\n- If you call `setCustomerIDs` on the server, those IDs will be added to the state that gets shared with the client, and `setCustomerIDs` will be automatically called on the client so you don't have to do it again. You only need to call `setCustomerIDs` on the client if you have more ids to set, in addition to the ones you set on the server already.\n- Use the static enum `Visitor.AuthState` to set the `authState` property of the customerIds.\n\n```javascript\n// Single ID with a single authentication state\nvisitor.setCustomerIDs({\n    \"userid\": {\n        \"id\": \"67312378756723456\",\n        \"authState\": Visitor.AuthState.AUTHENTICATED\n    }\n});\n\n/* \nMultiple IDs with only the first ID explicitly assigned an authentication state.\nThe second ID is not explicitly assigned an authentication state and is implicitly\nassigned Visitor.AuthState.Unknown by default.\n*/\nvisitor.setCustomerIDs({\n    \"userid\": {\n        \"id\": \"67312378756723456\",\n        \"authState\": Visitor.AuthState.AUTHENTICATED\n    },\n    \"puuid\": \"550e8400-e29b-41d4-a716-446655440000\"\n});\n```\n\nSee [Customer IDs and Authentication States](https://marketing.adobe.com/resources/help/en_US/mcvid/mcvid-authenticated-state.html)\n\n\n## Visitor#AuthState\n\nAuthState enum to be used when setting Customer IDs.\n\n```javascript\n{ UNKNOWN: 0, AUTHENTICATED: 1, LOGGED_OUT: 2 }\n```\n",
  "readmeFilename": "README.md",
  "scripts": {
    "build": "babel src --out-dir lib",
    "lint": "eslint .",
    "prebuild": "npm run lint",
    "precommit-msg": "echo 'Running pre-commit scripts...' && exit 0",
    "prepublish": "npm run build && autochecker 4.4.2 5.10.1 6.2.2",
    "test": "babel-tape-runner test/**/*.js | tap-spec",
    "watchtests": "nodemon -q --exec babel-tape-runner test/**/*.js | tap-spec"
  },
  "version": "0.0.9-alpha.1"
}
