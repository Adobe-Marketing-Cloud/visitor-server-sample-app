"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=Visitor;var _visitorJsShared=require("visitor-js-shared");var _visitorJsShared2=_interopRequireDefault(_visitorJsShared);var _cookies=require("./cookies");var _targetAdapter=require("./targetAdapter");var _targetAdapter2=_interopRequireDefault(_targetAdapter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var keysForAmcvValues=["MCMID","MCAAMB","MCAAMLH"];function Visitor(){var sdid=null;this.generateSupplementalID=function(){sdid=_visitorJsShared2.default.generateSupplementalID();return sdid};this.generateVisitorPayload=function(amcvCookie){var visitorPayload={sdid:this.generateSupplementalID()};if(amcvCookie){var amcvValues=(0,_cookies.parseValuesFromAmcvCookie)(amcvCookie,keysForAmcvValues);visitorPayload=Object.assign(visitorPayload,amcvValues)}var payloadAdaptedToTarget=_targetAdapter2.default.adapt(visitorPayload);return payloadAdaptedToTarget}}module.exports=exports["default"];"use strict";Object.defineProperty(exports,"__esModule",{value:true});var cookies={parseValuesFromAmcvCookie:function parseValuesFromAmcvCookie(cookie){var values=arguments.length<=1||arguments[1]===undefined?[]:arguments[1];var tokens=decodeURI(cookie).split("|");return values.reduce(function(amcvVals,val){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=tokens[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var param=_step.value;if(param.indexOf(val)>=0){var indexOfParam=tokens.indexOf(param);amcvVals[val]=tokens[indexOfParam+1];return amcvVals}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}},{})}};exports.default=cookies;module.exports=exports["default"];"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var payloadToTargetKeyMap={MCMID:"marketingCloudVisitorId",MCAAMB:"mboxAAMB",MCAAMLH:"mboxMCGLH",sdid:"mboxMCSDID",PUUID:"mboxAAMDPUUID",PID:"mboxAAMDPID",authStateId:"vst.authStateId",authState:"vst.authState.authState"};function createTargetSchema(){return{marketingCloudVisitorId:undefined,mboxParameters:{mboxAAMB:undefined,mboxMCGLH:undefined,mboxAAMDPUUID:undefined,mboxAAMDPID:undefined,"vst.authStateId":undefined,"vst.authState.authState":undefined,mboxMCSDID:undefined}}}function renameKeys(obj,keysMap){return Object.assign.apply(Object,[{}].concat(_toConsumableArray(Object.keys(obj).map(function(key){return _defineProperty({},keysMap[key],obj[key])}))))}var isObject=function isObject(val){return val===Object(val)};var filterFalsyProps=function filterFalsyProps(obj){return JSON.parse(JSON.stringify(obj))};function populate(schema,objWithValues){Object.keys(schema).forEach(function(key){if(isObject(schema[key])){populate(schema[key],objWithValues)}else if(objWithValues.hasOwnProperty(key)){schema[key]=objWithValues[key]}});return filterFalsyProps(schema)}function adapt(obj){var objWithTargetKeys=renameKeys(obj,payloadToTargetKeyMap);var targetSchema=createTargetSchema();return populate(targetSchema,objWithTargetKeys)}exports.default={adapt:adapt};module.exports=exports["default"];
